<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real-Time Speech-to-Text Transcription</title>
  </head>
  <body>
    <h1>Real-Time Speech-to-Text Transcription</h1>
    <button id="start-btn">Start Transcribing</button>
    <button id="stop-btn" disabled>Stop Transcribing</button>
    <pre id="output"></pre>

    <script>
      let mediaRecorder;
      const outputElement = document.getElementById("output");
      const startButton = document.getElementById("start-btn");
      const stopButton = document.getElementById("stop-btn");

      async function startTranscribing() {
        const stream = await navigator.mediaDevices.getUserMedia({
          audio: true,
        });
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.start();

        let audioChunks = [];

        mediaRecorder.ondataavailable = (event) => {
          audioChunks.push(event.data);
        };

        mediaRecorder.onstop = async () => {
          const audioBlob = new Blob(audioChunks, { type: "audio/wav" }); // Set appropriate MIME type
          const arrayBuffer = await audioBlob.arrayBuffer();

          // Send the audio to the Hugging Face Inference API
          const response = await fetch(
            "https://api-inference.huggingface.co/models/openai/whisper-tiny",
            {
              method: "POST",
              headers: {
                Authorization: `Bearer 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`, // Replace with your Hugging Face API key
                "Content-Type": "application/octet-stream", // This can also be 'audio/wav' if using a WAV format
              },
              body: arrayBuffer, // Send audio data as ArrayBuffer
            }
          );

          if (!response.ok) {
            const errorText = await response.text(); // Capture error response
            outputElement.textContent += "Error: " + errorText + "\n"; // Show detailed error
            return;
          }

          const data = await response.json();
          outputElement.textContent += data.text + "\n"; // Append new transcription
        };

        stopButton.disabled = false;
        startButton.disabled = true;
      }

      function stopTranscribing() {
        mediaRecorder.stop();
        stopButton.disabled = true;
        startButton.disabled = false;
      }

      startButton.onclick = () => startTranscribing();
      stopButton.onclick = () => stopTranscribing();
    </script>
  </body>
</html>
